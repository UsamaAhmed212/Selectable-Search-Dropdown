<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Searchable Dropdown</title>
    <style>
        /* Input field */
        #searchInput {
            width: 200px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Dropdown container */
        .dropdown {
            position: relative;
            display: inline-block;
            width: 200px;
        }

        /* Dropdown list */
        .dropdown-content {
            /* display: none; */
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            max-height: 150px;
            width: 100%;
            box-sizing: border-box;
            overflow-y: auto;
            /* overflow: hidden; */
            z-index: 1;
        }

        /* List items */
        .dropdown-content div {
            padding: 8px;
            cursor: pointer;
        }

        /* Hover and selected effect for items */
        .dropdown-content div.selected,
        .dropdown-content div:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>

    <h3>Searchable Dropdown</h3>
    <div class="dropdown">
        <input type="text" id="searchInput" placeholder="Search for an item...">
        <div class="dropdown-content" id="dropdownList">
            <div data-value="Rice">Rice - চাল</div>
            <div data-value="Sugar">Sugar - চিনি</div>
            <div data-value="Flour">Flour - ময়দা</div>
            <div data-value="Cooking Oil">Cooking Oil - তৈল</div>
            <div data-value="Salt">Salt - লবণ</div>
            <div data-value="Eggs">Eggs - ডিম</div>
            <div data-value="Red Chilli">Red Chilli - লাল মরিচ</div>
            <div data-value="Garlic">Garlic - রসুন</div>
            <div data-value="Ginger">Ginger - আদা</div>
        </div>
    </div>

    <script>
        let selectedIndex = -1; // Tracks the currently selected item in the dropdown
        let scrollInterval = null; // Stores interval for continuous scrolling

        // Event listener for keyup (handles search and navigation)
        document.getElementById("searchInput").addEventListener("keyup", function (event) {
            if (event.key === "Enter") selectHighlightedItem(); // Select the highlighted item on Enter
            if (event.key !== "Enter") handleSearch(); // Filter dropdown items based on input
        });

        // Event listener for focus (shows filtered dropdown items)
        document.getElementById("searchInput").addEventListener("focus", function () {
            handleSearch(); // Ensure dropdown updates when focused
            selectedIndex = -1; // Reset selected index
        });

        // Event listener to close dropdown when clicking outside
        document.addEventListener("click", function (event) {
            let dropdown = document.querySelector(".dropdown");
            if (!dropdown.contains(event.target)) hideDropdown(); // Hide dropdown if clicked outside
        });

        // Function to filter and display dropdown items based on input
        function handleSearch() {
            let input = document.getElementById("searchInput").value.toUpperCase();
            let dropdownList = document.getElementById("dropdownList");
            let items = dropdownList.querySelectorAll("div");

            dropdownList.style.display = "block"; // Show dropdown

            // Loop through each item and check if it matches the search input
            items.forEach(item => {
                let txtValue = item.textContent || item.innerText;
                item.style.display = txtValue.toUpperCase().includes(input) ? "" : "none"; // Show/hide item
            });
        }

        // Function to move selection up/down in the dropdown
        function navigateDropdown(direction) {
            let items = document.querySelectorAll("#dropdownList div");
            let visibleItems = Array.from(items).filter(item => item.style.display !== "none"); // Get only visible items

            if (visibleItems.length === 0) return; // Stop if no visible items

            // Handle first up key press
            if (selectedIndex === -1 && direction === -1) {
                selectedIndex = visibleItems.length - 1; // Start from the last item
            } else {
                // Update selected index
                selectedIndex = (selectedIndex + direction + visibleItems.length) % visibleItems.length;
            }

            // Highlight the selected item
            visibleItems.forEach((item, index) => {
                item.classList.toggle("selected", index === selectedIndex);
            });

            scrollIntoView(visibleItems[selectedIndex]); // Ensure selected item is in view
        }


        // Function to scroll the selected item into view if it's out of bounds
        function scrollIntoView(selectedItem) {
            if (!selectedItem) return; // Do nothing if no item is selected

            let dropdown = document.getElementById("dropdownList");
            let itemTop = selectedItem.offsetTop;
            let itemBottom = itemTop + selectedItem.offsetHeight;
            let dropdownTop = dropdown.scrollTop;
            let dropdownBottom = dropdownTop + dropdown.offsetHeight;

            // Scroll down if selected item is below visible area
            if (itemBottom > dropdownBottom) dropdown.scrollTop = itemBottom - dropdown.offsetHeight;

            // Scroll up if selected item is above visible area
            if (itemTop < dropdownTop) dropdown.scrollTop = itemTop;
        }

        // Function to select an item and update the input field
        function selectItem(value) {
            document.getElementById("searchInput").value = value; // Set input value to selected item
            hideDropdown(); // Hide dropdown after selection
            selectedIndex = -1; // Reset selected index
        }

        // Attach event listeners to each item dynamically
        document.querySelectorAll('#dropdownList div[data-value]').forEach(item => {
            item.addEventListener('click', function () {
                // const value = this.getAttribute('data-value'); // Get the value from the data attribute
                // selectItem(value);
                selectItem(this.textContent.trim());
            });
        });

        // Function to select the currently highlighted item when pressing Enter
        function selectHighlightedItem() {
            let items = document.querySelectorAll("#dropdownList div");
            let visibleItems = Array.from(items).filter(item => item.style.display !== "none");

            // Remove Highlight the selected item
            visibleItems.forEach((item, index) => {
                item.classList.remove('selected');
            });

            if (visibleItems.length) {
                let index = selectedIndex >= 0 ? selectedIndex : 0;
                selectItem(visibleItems[index]?.textContent.trim());
            }
        }

        // Function to hide the dropdown list
        function hideDropdown() {
            document.getElementById("dropdownList").style.display = "none"; // Hide dropdown
        }

        // Event listener for keydown (handles continuous scrolling on arrow key long press)
        document.getElementById("searchInput").addEventListener("keydown", function (event) {
            if (event.key === "ArrowDown" || event.key === "ArrowUp") {
                event.preventDefault(); // Prevent default scrolling behavior
                if (!scrollInterval) {
                    navigateDropdown(event.key === "ArrowDown" ? 1 : -1); // Move once
                    scrollInterval = setInterval(() => navigateDropdown(event.key === "ArrowDown" ? 1 : -1), 200); // Move continuously (200ms)
                }
            }
        });

        // Event listener for keyup to stop continuous scrolling
        document.getElementById("searchInput").addEventListener("keyup", function (event) {
            if (event.key === "ArrowDown" || event.key === "ArrowUp") {
                clearInterval(scrollInterval); // Stop scrolling when key is released
                scrollInterval = null;
            }
        });
    </script>
</body>

</html>